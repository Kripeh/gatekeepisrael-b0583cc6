---
import { Image } from 'astro:assets';

interface Props {
  src: string;
  alt: string;
  width?: number;
  height?: number;
  loading?: 'eager' | 'lazy';
  class?: string;
  sizes?: string;
  fetchpriority?: 'high' | 'low' | 'auto';
}

const {
  src,
  alt,
  width,
  height,
  loading = 'lazy',
  class: className = '',
  sizes = '(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 1200px',
  fetchpriority,
} = Astro.props;

// Check if image is external (from Supabase or other CDN)
const isExternal = src.startsWith('http');

// For external images, use picture element with multiple formats
// For local images, use Astro's Image component which automatically optimizes
---

{
  isExternal ? (
    <picture>
      <source srcset={`${src}?format=avif&quality=80`} type="image/avif" />
      <source srcset={`${src}?format=webp&quality=85`} type="image/webp" />
      <img
        src={src}
        alt={alt}
        loading={loading}
        class={className}
        width={width}
        height={height}
        fetchpriority={fetchpriority}
      />
    </picture>
  ) : (
    <Image
      src={src}
      alt={alt}
      width={width || 800}
      height={height || 600}
      format="avif"
      quality={80}
      loading={loading}
      class={className}
      sizes={sizes}
      fetchpriority={fetchpriority}
    />
  )
}
