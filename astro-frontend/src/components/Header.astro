---
import DesktopMegaMenu from './react/DesktopMegaMenu';

interface Props {
  currentPath: string;
}

const { currentPath } = Astro.props;

const PHONE_LINK = 'tel:+972508585310';

const NAV_LINKS = [
  { href: '/', label: 'דף הבית', category: null },

  // שירותים
  { href: '/installation', label: 'התקנת גדר חשמלית', category: 'שירותים' },
  { href: '/solar-fence', label: 'גדר סולארית', category: 'שירותים' },
  { href: '/home-solutions', label: 'פתרונות לבית', category: 'שירותים' },
  { href: '/pricing', label: 'מחירון ומחשבון', category: 'שירותים' },

  // מוצרים
  { href: '/products/solar-energizers', label: 'מחוללי מתח סולאריים', category: 'מוצרים' },
  { href: '/products/insulators', label: 'מבודדים ורכיבי גידור', category: 'מוצרים' },
  { href: '/products/testing-equipment', label: 'מכשור מדידה ובדיקה', category: 'מוצרים' },

  // למד
  { href: '/why-electric-fence', label: 'למה גדר חשמלית?', category: 'למד' },
  { href: '/blog', label: 'בלוג ומאמרים', category: 'למד' },

  // אזורי שירות
  { href: '/service-areas', label: 'כיסוי ארצי', category: 'אזורי שירות' },
  { href: '/regions/haifa', label: 'חיפה והקריות', category: 'אזורי שירות' },
  { href: '/regions/carmel-coast', label: 'חוף הכרמל', category: 'אזורי שירות' },
  { href: '/regions/jordan-valley', label: 'עמק הירדן', category: 'אזורי שירות' },
];

// Group links by category for mobile menu
const groupedLinks = NAV_LINKS.reduce((acc, link) => {
  const category = link.category || 'ראשי';
  if (!acc[category]) acc[category] = [];
  acc[category].push(link);
  return acc;
}, {} as Record<string, typeof NAV_LINKS>);
---
<header class="fixed top-0 right-0 left-0 z-50 bg-background/95 backdrop-blur-md border-b border-border">
  <div class="container mx-auto px-4 py-3">
    <div class="flex items-center justify-between gap-4">
      <!-- Right side: Logo + Hamburger (mobile) -->
      <div class="flex items-center gap-3 flex-shrink-0">
        <a href="/">
          <img src="/logo.png" alt="גייטקיפ" class="h-12 md:h-16 w-auto" />
        </a>

        <!-- Mobile hamburger -->
        <button
          id="mobile-menu-toggle"
          class="lg:hidden p-2 text-foreground hover:text-primary transition-colors rounded-lg hover:bg-primary/5"
          aria-label="פתח תפריט"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
        </button>
      </div>

      <!-- Desktop Mega Menu (centered) -->
      <div class="hidden lg:flex flex-1 justify-center">
        <DesktopMegaMenu client:load />
      </div>

      <!-- Left side: CTA button -->
      <a
        href={PHONE_LINK}
        class="btn-cta-glow flex-shrink-0 flex items-center gap-2 px-4 py-2 md:px-6 md:py-3 rounded-xl text-sm md:text-base font-bold"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 md:w-5 md:h-5"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
        <span class="hidden sm:inline">שיחת ייעוץ מיידית</span>
        <span class="sm:hidden">התקשר</span>
      </a>
    </div>
  </div>

</header>

<!-- Mobile Menu Drawer -->
<div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 z-[60] hidden"></div>
<nav id="mobile-menu-drawer" class="fixed top-0 right-0 h-full w-80 bg-background border-l border-border z-[70] transform translate-x-full transition-transform duration-300" aria-label="תפריט נייד">
  <div class="p-4 border-b border-border flex items-center justify-between">
    <img src="/logo.png" alt="גייטקיפ" class="h-12 w-auto" />
    <button id="mobile-menu-close" class="p-2 text-foreground hover:text-primary" aria-label="סגור תפריט">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
    </button>
  </div>
  <div class="flex flex-col p-4 overflow-y-auto h-[calc(100vh-180px)]">
    {Object.entries(groupedLinks).map(([category, links]) => (
      <div class="mb-4">
        {category !== 'ראשי' && (
          <div class="text-xs font-bold text-gray-500 uppercase tracking-wider px-4 mb-2 mt-2">
            {category}
          </div>
        )}
        {links.map((link) => (
          <a
            href={link.href}
            class:list={[
              'block py-3 px-4 text-base font-medium rounded-lg transition-colors',
              currentPath === link.href
                ? 'text-primary font-bold bg-primary/10'
                : 'text-foreground hover:text-primary hover:bg-primary/5',
            ]}
          >
            {link.label}
          </a>
        ))}
      </div>
    ))}
  </div>
  <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-border bg-background">
    <a href={PHONE_LINK} class="btn-cta-glow flex items-center justify-center gap-2 w-full py-4 rounded-xl text-lg font-bold">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
      <span>שיחת ייעוץ מיידית</span>
    </a>
  </div>
</nav>

<script>
  const toggle = document.getElementById('mobile-menu-toggle');
  const close = document.getElementById('mobile-menu-close');
  const overlay = document.getElementById('mobile-menu-overlay');
  const drawer = document.getElementById('mobile-menu-drawer');

  function openMenu() {
    overlay?.classList.remove('hidden');
    drawer?.classList.remove('translate-x-full');
  }
  function closeMenu() {
    overlay?.classList.add('hidden');
    drawer?.classList.add('translate-x-full');
  }

  toggle?.addEventListener('click', openMenu);
  close?.addEventListener('click', closeMenu);
  overlay?.addEventListener('click', closeMenu);
</script>
